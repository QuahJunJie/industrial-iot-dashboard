{
  "version": "v1.12.5",
  "platform": "Core2",
  "mode": "block_coding",
  "blockly": {
    "xml": "<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"temp\">temp</variable><variable id=\"vib\">vib</variable><variable id=\"distance\">distance</variable><variable id=\"status\">status</variable><variable id=\"payload\">payload</variable><variable id=\"ts\">ts</variable></variables><block type=\"m5_setup\" x=\"30\" y=\"30\"><statement name=\"SETUP\"><block type=\"ui_screen_bgcolor\"><value name=\"COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#1a1a2e</field></block></value><next><block type=\"ui_title\"><field name=\"TITLE\">AEGIS-ONE IoT</field><value name=\"COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#00ff88</field></block></value><value name=\"X\"><block type=\"math_number\"><field name=\"NUM\">60</field></block></value><value name=\"Y\"><block type=\"math_number\"><field name=\"NUM\">10</field></block></value><next><block type=\"label_create\"><field name=\"NAME\">lblTemp</field><value name=\"TEXT\"><block type=\"text\"><field name=\"TEXT\">Temp: --°C</field></block></value><value name=\"X\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><value name=\"Y\"><block type=\"math_number\"><field name=\"NUM\">60</field></block></value><value name=\"FONT\"><block type=\"font_montserrat\"><field name=\"FONT\">FONT_MONT_18</field></block></value><value name=\"FG_COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ffffff</field></block></value><next><block type=\"label_create\"><field name=\"NAME\">lblVib</field><value name=\"TEXT\"><block type=\"text\"><field name=\"TEXT\">Vib: --mm/s</field></block></value><value name=\"X\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><value name=\"Y\"><block type=\"math_number\"><field name=\"NUM\">100</field></block></value><value name=\"FONT\"><block type=\"font_montserrat\"><field name=\"FONT\">FONT_MONT_18</field></block></value><value name=\"FG_COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ffffff</field></block></value><next><block type=\"label_create\"><field name=\"NAME\">lblDist</field><value name=\"TEXT\"><block type=\"text\"><field name=\"TEXT\">Dist: --cm</field></block></value><value name=\"X\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><value name=\"Y\"><block type=\"math_number\"><field name=\"NUM\">140</field></block></value><value name=\"FONT\"><block type=\"font_montserrat\"><field name=\"FONT\">FONT_MONT_18</field></block></value><value name=\"FG_COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ffffff</field></block></value><next><block type=\"label_create\"><field name=\"NAME\">lblStatus</field><value name=\"TEXT\"><block type=\"text\"><field name=\"TEXT\">Status: INIT</field></block></value><value name=\"X\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><value name=\"Y\"><block type=\"math_number\"><field name=\"NUM\">180</field></block></value><value name=\"FONT\"><block type=\"font_montserrat\"><field name=\"FONT\">FONT_MONT_18</field></block></value><value name=\"FG_COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ffcc00</field></block></value><next><block type=\"aws_iot_setup\"><field name=\"NAME\">aws</field><field name=\"THING_NAME\">AegisOne_M5_01</field><field name=\"HOST\">arn:aws:iot:ap-southeast-1:109990058588:thing/AegisOne_M5_01</field><field name=\"PORT\">8883</field><field name=\"KEEPALIVE\">60</field><field name=\"CERT\">/flash/res/cert.crt</field><field name=\"KEY\">/flash/res/private.pem.key</field></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><statement name=\"LOOP\"><block type=\"variables_set\"><field name=\"VAR\">temp</field><value name=\"VALUE\"><block type=\"imu_get_temperature\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\">vib</field><value name=\"VALUE\"><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"math_abs\"><value name=\"NUM\"><block type=\"imu_get_accel\"><field name=\"AXIS\">x</field></block></value></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">9.81</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\">distance</field><value name=\"VALUE\"><block type=\"ultrasonic_get_distance\"><field name=\"PORT\">portb</field></block></value><next><block type=\"controls_if\"><mutation elseif=\"1\" else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get\"><field name=\"VAR\">temp</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">45</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get\"><field name=\"VAR\">vib</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">2.5</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\">status</field><value name=\"VALUE\"><block type=\"text\"><field name=\"TEXT\">CRITICAL</field></block></value><next><block type=\"ui_screen_bgcolor\"><value name=\"COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ff0000</field></block></value></block></next></block></statement><value name=\"IF1\"><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get\"><field name=\"VAR\">temp</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">35</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get\"><field name=\"VAR\">vib</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">1.5</field></block></value></block></value></block></value><statement name=\"DO1\"><block type=\"variables_set\"><field name=\"VAR\">status</field><value name=\"VALUE\"><block type=\"text\"><field name=\"TEXT\">WARNING</field></block></value><next><block type=\"ui_screen_bgcolor\"><value name=\"COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#ff8800</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\">status</field><value name=\"VALUE\"><block type=\"text\"><field name=\"TEXT\">RUNNING</field></block></value><next><block type=\"ui_screen_bgcolor\"><value name=\"COLOR\"><block type=\"color_make\"><field name=\"COLOR\">#1a1a2e</field></block></value></block></next></block></statement><next><block type=\"label_set_text\"><field name=\"NAME\">lblTemp</field><value name=\"TEXT\"><block type=\"text_join\"><mutation items=\"3\"></mutation><value name=\"ADD0\"><block type=\"text\"><field name=\"TEXT\">Temp: </field></block></value><value name=\"ADD1\"><block type=\"math_round\"><value name=\"NUM\"><block type=\"variables_get\"><field name=\"VAR\">temp</field></block></value></block></value><value name=\"ADD2\"><block type=\"text\"><field name=\"TEXT\">°C</field></block></value></block></value><next><block type=\"label_set_text\"><field name=\"NAME\">lblVib</field><value name=\"TEXT\"><block type=\"text_join\"><mutation items=\"3\"></mutation><value name=\"ADD0\"><block type=\"text\"><field name=\"TEXT\">Vib: </field></block></value><value name=\"ADD1\"><block type=\"math_round\"><value name=\"NUM\"><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"variables_get\"><field name=\"VAR\">vib</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">10</field></block></value></block></value></block></value><value name=\"ADD2\"><block type=\"text\"><field name=\"TEXT\">mm/s</field></block></value></block></value><next><block type=\"label_set_text\"><field name=\"NAME\">lblDist</field><value name=\"TEXT\"><block type=\"text_join\"><mutation items=\"3\"></mutation><value name=\"ADD0\"><block type=\"text\"><field name=\"TEXT\">Dist: </field></block></value><value name=\"ADD1\"><block type=\"math_round\"><value name=\"NUM\"><block type=\"variables_get\"><field name=\"VAR\">distance</field></block></value></block></value><value name=\"ADD2\"><block type=\"text\"><field name=\"TEXT\">cm</field></block></value></block></value><next><block type=\"label_set_text\"><field name=\"NAME\">lblStatus</field><value name=\"TEXT\"><block type=\"text_join\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\"><field name=\"TEXT\">Status: </field></block></value><value name=\"ADD1\"><block type=\"variables_get\"><field name=\"VAR\">status</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\">ts</field><value name=\"VALUE\"><block type=\"time_get_timestamp\"></block></value><next><block type=\"aws_iot_publish\"><field name=\"NAME\">aws</field><value name=\"TOPIC\"><block type=\"text\"><field name=\"TEXT\">aegisone/telemetry</field></block></value><value name=\"PAYLOAD\"><block type=\"text_join\"><mutation items=\"13\"></mutation><value name=\"ADD0\"><block type=\"text\"><field name=\"TEXT\">{\"deviceId\":\"aegis-one\",\"temp\":</field></block></value><value name=\"ADD1\"><block type=\"variables_get\"><field name=\"VAR\">temp</field></block></value><value name=\"ADD2\"><block type=\"text\"><field name=\"TEXT\">,\"vib\":</field></block></value><value name=\"ADD3\"><block type=\"variables_get\"><field name=\"VAR\">vib</field></block></value><value name=\"ADD4\"><block type=\"text\"><field name=\"TEXT\">,\"distance\":</field></block></value><value name=\"ADD5\"><block type=\"variables_get\"><field name=\"VAR\">distance</field></block></value><value name=\"ADD6\"><block type=\"text\"><field name=\"TEXT\">,\"status\":\"</field></block></value><value name=\"ADD7\"><block type=\"variables_get\"><field name=\"VAR\">status</field></block></value><value name=\"ADD8\"><block type=\"text\"><field name=\"TEXT\">\",\"ts\":</field></block></value><value name=\"ADD9\"><block type=\"variables_get\"><field name=\"VAR\">ts</field></block></value><value name=\"ADD10\"><block type=\"text\"><field name=\"TEXT\">}</field></block></value></block></value><next><block type=\"wait_seconds\"><value name=\"VALUE\"><block type=\"math_number\"><field name=\"NUM\">5</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>"
  },
  "python": "from m5stack import *\nfrom m5stack_ui import *\nfrom uiflow import *\nfrom IoTcloud.AWS import AWS\nimport imu\nimport time\n\n# Initialize screen\nscreen = M5Screen()\nscreen.clean_screen()\nscreen.set_screen_bg_color(0x1a1a2e)\n\n# Configuration - EDIT THESE VALUES\nWIFI_SSID = \"YOUR_WIFI\"\nWIFI_PASSWORD = \"YOUR_PASSWORD\"\nAWS_THING_NAME = \"AegisOne_M5_01\"\nAWS_HOST = \"arn:aws:iot:ap-southeast-1:109990058588:thing/AegisOne_M5_01\"\nAWS_PORT = 8883\n\n# Thresholds\nTEMP_WARNING = 35\nTEMP_CRITICAL = 45\nVIB_WARNING = 1.5\nVIB_CRITICAL = 2.5\n\n# Colors\nCOLOR_BG = 0x1a1a2e\nCOLOR_GREEN = 0x00ff88\nCOLOR_YELLOW = 0xffcc00\nCOLOR_RED = 0xff0000\nCOLOR_ORANGE = 0xff8800\nCOLOR_WHITE = 0xffffff\n\n# UI Labels\nlblTitle = M5Label('AEGIS-ONE IoT', x=60, y=10, color=COLOR_GREEN, font=FONT_MONT_18)\nlblTemp = M5Label('Temp: --°C', x=20, y=60, color=COLOR_WHITE, font=FONT_MONT_18)\nlblVib = M5Label('Vib: --mm/s', x=20, y=100, color=COLOR_WHITE, font=FONT_MONT_18)\nlblDist = M5Label('Dist: --cm', x=20, y=140, color=COLOR_WHITE, font=FONT_MONT_18)\nlblStatus = M5Label('Status: INIT', x=20, y=180, color=COLOR_YELLOW, font=FONT_MONT_18)\nlblConn = M5Label('Connecting...', x=20, y=220, color=COLOR_YELLOW, font=FONT_MONT_14)\n\n# Initialize IMU for vibration\nimu0 = imu.IMU()\n\n# Connect WiFi\nwifiCfg.doConnect(WIFI_SSID, WIFI_PASSWORD)\nwhile not wifiCfg.wlan_sta.isconnected():\n    wait(1)\n    lblConn.set_text('Connecting to WiFi...')\n\nlblConn.set_text('WiFi Connected!')\nlblConn.set_text_color(COLOR_GREEN)\n\n# Connect AWS IoT\naws = AWS(\n    things_name=AWS_THING_NAME,\n    host=AWS_HOST,\n    port=AWS_PORT,\n    keepalive=60,\n    cert_file_path=\"/flash/res/cert.crt\",\n    private_key_path=\"/flash/res/private.pem.key\"\n)\naws.start()\nlblConn.set_text('AWS IoT Connected!')\n\ndef get_status(temp, vib):\n    if temp > TEMP_CRITICAL or vib > VIB_CRITICAL:\n        return 'CRITICAL', COLOR_RED\n    elif temp > TEMP_WARNING or vib > VIB_WARNING:\n        return 'WARNING', COLOR_ORANGE\n    else:\n        return 'RUNNING', COLOR_BG\n\n# Main loop\nwhile True:\n    try:\n        # Read sensors\n        temp = imu0.temperature\n        ax = imu0.acceleration[0]\n        ay = imu0.acceleration[1]\n        az = imu0.acceleration[2]\n        vib = ((ax**2 + ay**2 + az**2)**0.5) * 0.5\n        \n        # Ultrasonic - uncomment if connected\n        # distance = ultrasonic.get_distance()\n        distance = 100  # Placeholder\n        \n        # Determine status\n        status, bg_color = get_status(temp, vib)\n        screen.set_screen_bg_color(bg_color)\n        \n        # Update display\n        lblTemp.set_text('Temp: {:.1f}C'.format(temp))\n        lblVib.set_text('Vib: {:.2f}mm/s'.format(vib))\n        lblDist.set_text('Dist: {}cm'.format(int(distance)))\n        lblStatus.set_text('Status: ' + status)\n        \n        # Set status color\n        if status == 'CRITICAL':\n            lblStatus.set_text_color(COLOR_RED)\n        elif status == 'WARNING':\n            lblStatus.set_text_color(COLOR_YELLOW)\n        else:\n            lblStatus.set_text_color(COLOR_GREEN)\n        \n        # Get timestamp\n        ts = int(time.time() * 1000)\n        \n        # Build JSON payload\n        payload = '{{\"deviceId\":\"aegis-one\",\"temp\":{:.1f},\"vib\":{:.2f},\"distance\":{},\"status\":\"{}\",\"ts\":{}}}'.format(\n            temp, vib, int(distance), status, ts\n        )\n        \n        # Publish to AWS IoT\n        aws.publish('aegisone/telemetry', payload)\n        lblConn.set_text('Published: ' + str(ts)[-6:])\n        \n    except Exception as e:\n        lblConn.set_text('Error: ' + str(e)[:20])\n        lblConn.set_text_color(COLOR_RED)\n    \n    wait(5)\n",
  "settings": {
    "wifi": {
      "ssid": "YOUR_WIFI",
      "password": "YOUR_PASSWORD"
    },
    "aws": {
      "thing_name": "AegisOne_M5_01",
      "host": "arn:aws:iot:ap-southeast-1:109990058588:thing/AegisOne_M5_01",
      "port": 8883,
      "cert": "/flash/res/cert.crt",
      "key": "/flash/res/private.pem.key"
    }
  }
}
